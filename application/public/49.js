(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{ElBU:function(e,t,s){"use strict";s.r(t);var r=s("vDqi"),a=s.n(r),i=s("KnK+"),o=s("Snq/"),l=s.n(o),n=(s("bfyA"),s("kGIl")),_=s.n(n),c=s("EvnB"),u=(s("5A0h"),s("0XMT")),m={name:"TheUserSettings",mixins:[i.a],data:function(){return{breadcrumbs:[{text:"Главная",to:{path:"/"}},{text:"Список пользователей по информированию Сервис тикетов",active:!0}],isLoading:!0,errors:null,notif_list:[],formErrors:null,add_user_form:0,user_search:"",user_search_ad:"",service_options:[],priority_list:[{id:0,label:"По всем"},{id:1,label:"Только Emergency"},{id:2,label:"Critical и выше"},{id:3,label:"High и выше"},{id:4,label:"Medium и выше"}],tt_type_list:[{id:0,label:"По всем"},{id:1,label:"Только События"},{id:2,label:"Только Инциденты"}],network_type_list:[{id:0,label:"По всем"},{id:1,label:"Только Telco"},{id:2,label:"Только IT"}],region_list:[{id:0,label:"По всем"},{id:1,label:"Almaty"},{id:2,label:"South"},{id:3,label:"North"},{id:4,label:"West"},{id:7,label:"East"},{id:8,label:"Astana"}],inform_type_list:[{id:1,label:"Только Email"},{id:2,label:"Email/SMS"}],user_list:[],user_list_ad:[],form:{sel_service_type_all:1,sel_service_group:[],sel_service_item:[],sel_priority:null,sel_tt_type:null,sel_network_type:null,sel_region:null,sel_inform_type:null,sel_users:null},form_search_ad:{search_user_email:"",search_user_pass:"",search_user_email2:""},columns:[{label:"Имя пользователя",name:"user_name",filter:{type:"simple",placeholder:"Имя пользователя"},sort:!0},{label:"Приоритет",name:"trigger_info.priority_name",filter:{type:"simple",placeholder:"Приоритет"},sort:!0},{label:"Тип тикета",name:"trigger_info.tt_type_name",filter:{type:"simple",placeholder:"Тип тикета"},sort:!0},{label:"Тип сети",name:"trigger_info.network_type_name",filter:{type:"simple",placeholder:"Тип сети"},sort:!0},{label:"Регион",name:"trigger_info.region_name",filter:{type:"simple",placeholder:"Регион"},sort:!0},{label:"Тип инф.",name:"inform_type_name",filter:{type:"simple",placeholder:"Тип инф."},sort:!0}],classes:{table:{"table-striped table-sm":!0,"table-bordered my-class-two":function(e){return!0}}},config:{checkbox_rows:!1,rows_selectable:!0,card_title:"teet",per_page:50,global_search:{placeholder:"Поиск",visibility:!1,case_sensitive:!1},per_page_options:[10,20,50,100],show_refresh_button:!1,show_reset_button:!1,card_mode:!1}}},components:{Loading:_.a,VueBootstrap4Table:c.a,vSelect:l.a},mounted:function(){this.generateBreadcrumb(this.breadcrumbs),this.getNotifList(),this.getServices()},watch:{user_search:function(e){var t=this;e.length>2&&(e=e.toLowerCase(),a.a.get("/api/catalog/user_list/search?query=".concat(e)).then((function(e){t.user_list=e.data.list})))}},computed:{detail:function(){return this.$store.getters.SERVICE_LIST},userInfo:function(){return this.form_search_ad.search_user_email=this.$store.getters.MY_USER_INFO.email,this.$store.getters.MY_USER_INFO}},methods:{getNotifList:function(){var e=this;a.a.get("/api/catalog/notification_list/search").then((function(t){e.notif_list=t.data.list,e.add_user_form=0}))},getServices:function(){this.$store.dispatch(u.a)},searchUserFromAD:function(){var e=this;a.a.post("/api/catalog/search_user_ad",this.$data.form_search_ad).then((function(t){e.user_list_ad.push(t.data.result)})).catch((function(t){t.response.data&&(e.formErrors=t.response.data.errors)}))},saveUserFromAd:function(){var e=this,t={};t.user_list=this.user_list_ad,a.a.post("/api/catalog/save_user_from_ad",t).then((function(t){console.log(t),e.form_search_ad.search_user_email2="",e.user_list_ad=[]})).catch((function(t){t.response.data&&(e.formErrors=t.response.data.errors)}))},saveUsersToNotification:function(){var e=this;a.a.post("/api/catalog/save_users_to_notification",this.$data.form).then((function(t){console.log(t),e.form={sel_service_type_all:1,sel_service_group:[],sel_service_item:[],sel_priority:null,sel_tt_type:null,sel_network_type:null,sel_region:null,sel_inform_type:null,sel_users:null},e.getNotifList()})).catch((function(t){t.response.data&&(e.formErrors=t.response.data.errors)}))}}},d=s("KHd+"),v=Object(d.a)(m,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{height:"99%"}},[s("div",{staticClass:"card",staticStyle:{height:"100%"}},[s("div",{staticClass:"row no-space"},[s("div",{staticClass:"p-2 text-right w-100"},[0==e.add_user_form?s("a",{staticClass:"btn btn-outline-primary btn-sm",staticStyle:{width:"150px"},attrs:{href:"#"},on:{click:function(t){e.add_user_form=1}}},[e._v("\n                    Добавить пользователя\n                ")]):e._e(),e._v(" "),1==e.add_user_form?s("a",{staticClass:"btn btn-outline-danger btn-sm",staticStyle:{width:"150px"},attrs:{href:"#"},on:{click:function(t){e.add_user_form=0}}},[e._v("\n                    Отменить\n                ")]):e._e(),e._v(" "),1==e.add_user_form?s("hr"):e._e()])]),e._v(" "),1==e.add_user_form?s("div",{staticClass:"row no-space",staticStyle:{height:"95%"}},[s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"inform_type"}},[e._v("Тип информирования")]),e._v(" "),s("v-select",{attrs:{id:"inform_type",options:e.inform_type_list},model:{value:e.form.sel_inform_type,callback:function(t){e.$set(e.form,"sel_inform_type",t)},expression:"form.sel_inform_type"}})],1),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"priority"}},[e._v("Приоритет")]),e._v(" "),s("v-select",{attrs:{id:"priority",options:e.priority_list},model:{value:e.form.sel_priority,callback:function(t){e.$set(e.form,"sel_priority",t)},expression:"form.sel_priority"}})],1),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"tt_type"}},[e._v("Тип тикета")]),e._v(" "),s("v-select",{attrs:{id:"tt_type",options:e.tt_type_list},model:{value:e.form.sel_tt_type,callback:function(t){e.$set(e.form,"sel_tt_type",t)},expression:"form.sel_tt_type"}})],1),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"network_type"}},[e._v("Тип сети")]),e._v(" "),s("v-select",{attrs:{id:"network_type",options:e.network_type_list},model:{value:e.form.sel_network_type,callback:function(t){e.$set(e.form,"sel_network_type",t)},expression:"form.sel_network_type"}})],1),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"region"}},[e._v("Регион")]),e._v(" "),s("v-select",{attrs:{id:"region",options:e.region_list,multiple:""},model:{value:e.form.sel_region,callback:function(t){e.$set(e.form,"sel_region",t)},expression:"form.sel_region"}})],1)]),e._v(" "),s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"service_type"}},[e._v("Тип сервиса")]),e._v(" "),s("b-form-group",{staticClass:"p-1 rounded-lg",staticStyle:{border:"1px solid silver"}},[s("b-form-checkbox",{attrs:{id:"service_type_all",name:"service_type_all",value:"1","unchecked-value":"0"},model:{value:e.form.sel_service_type_all,callback:function(t){e.$set(e.form,"sel_service_type_all",t)},expression:"form.sel_service_type_all"}},[e._v("\n                            По всем сервисам\n                        ")])],1),e._v(" "),s("b-form-group",{staticClass:"p-1 rounded-lg",staticStyle:{border:"1px solid silver",height:"300px","overflow-y":"auto"}},e._l(e.detail.list,(function(t,r){return s("b-form-checkbox",{key:r,attrs:{value:t.id},model:{value:e.form.sel_service_group,callback:function(t){e.$set(e.form,"sel_service_group",t)},expression:"form.sel_service_group"}},[e._v("\n                            "+e._s(t.group_name)+"\n                            "),s("br"),e._v(" "),e._l(t.services,(function(r,a){return s("b-form-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.form.sel_service_group.includes(t.id),expression:"form.sel_service_group.includes(item.id)"}],key:a,attrs:{value:r.id},model:{value:e.form.sel_service_item,callback:function(t){e.$set(e.form,"sel_service_item",t)},expression:"form.sel_service_item"}},[e._v("\n                                "+e._s(r.service_name)+"\n                            ")])}))],2)})),1)],1)]),e._v(" "),s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"form-group",staticStyle:{height:"250px","overflow-y":"auto"}},[s("label",{attrs:{for:"users"}},[e._v("Пользователь/Email учётная запись")]),e._v(" "),s("v-select",{attrs:{id:"users",options:e.user_list,multiple:""},on:{search:function(t){return e.user_search=t}},model:{value:e.form.sel_users,callback:function(t){e.$set(e.form,"sel_users",t)},expression:"form.sel_users"}})],1),e._v(" "),s("hr"),e._v(" "),s("button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-add-ad-user",modifiers:{"modal-add-ad-user":!0}}],staticClass:"btn btn-outline-primary btn-sm w-100",on:{click:function(e){}}},[e._v("\n                    Добавить пользователя с ActiveDirectory\n                ")]),e._v(" "),s("span",{staticStyle:{"font-style":"italic","font-size":"10px"}},[e._v("* если пользователь не найден в общем списке")]),e._v(" "),s("b-modal",{attrs:{id:"modal-add-ad-user",size:"md",centered:"",title:"Добавление пользователя с ActiveDirectory"},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var r=t.ok,a=t.cancel;return[s("b-button",{attrs:{size:"sm",variant:"info"},on:{click:function(e){return a()}}},[e._v("\n                            Отменить\n                        ")]),e._v(" "),s("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(t){e.saveUserFromAd(),r()}}},[e._v("\n                            Добавить пользователя/ей\n                        ")])]}}],null,!1,1172607653)},[s("div",{staticClass:"table-responsive",staticStyle:{"min-height":"400px"}},[s("span",{staticClass:"p-1",staticStyle:{"font-style":"italic"}},[e._v("Данные для авторизации в ActiveDirectory")]),e._v(" "),s("hr",{staticClass:"m-2"}),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"search_user_email"}},[e._v("Email ("),s("span",{staticStyle:{"font-weight":"bold","font-style":"italic","font-size":"10px"}},[e._v(e._s(e.userInfo.name))]),e._v(")")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.form_search_ad.search_user_email,expression:"form_search_ad.search_user_email"}],staticClass:"form-control",attrs:{type:"text",id:"search_user_email"},domProps:{value:e.form_search_ad.search_user_email},on:{input:function(t){t.target.composing||e.$set(e.form_search_ad,"search_user_email",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"search_user_pass"}},[e._v("Пароль")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.form_search_ad.search_user_pass,expression:"form_search_ad.search_user_pass"}],staticClass:"form-control",attrs:{type:"password",id:"search_user_pass"},domProps:{value:e.form_search_ad.search_user_pass},on:{input:function(t){t.target.composing||e.$set(e.form_search_ad,"search_user_pass",t.target.value)}}})]),e._v(" "),s("hr"),e._v(" "),s("hr"),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"search_user_email2"}},[e._v("Email пользователя, которого необходимо добавить")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.form_search_ad.search_user_email2,expression:"form_search_ad.search_user_email2"}],staticClass:"form-control",attrs:{type:"text",id:"search_user_email2"},domProps:{value:e.form_search_ad.search_user_email2},on:{input:function(t){t.target.composing||e.$set(e.form_search_ad,"search_user_email2",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group text-right"},[s("b-button",{staticClass:"w-100",attrs:{size:"sm",variant:"success"},on:{click:function(t){return e.searchUserFromAD()}}},[e._v("\n                                Найти\n                            ")])],1),e._v(" "),s("hr"),e._v(" "),s("div",{staticStyle:{height:"250px","overflow-y":"auto"}},[s("table",{staticClass:"table table-sm table-light",staticStyle:{"font-size":"10px"}},[s("tr",[s("th",[e._v("Имя")]),e._v(" "),s("th",[e._v("Департамент")]),e._v(" "),s("th",[e._v("Позиция")]),e._v(" "),s("th",[e._v("-")])]),e._v(" "),e._l(e.user_list_ad,(function(t){return s("tr",[s("td",{staticClass:"border-bottom"},[e._v(e._s(t.name))]),e._v(" "),s("td",{staticClass:"border-bottom"},[s("div",{staticClass:"truncate-text",staticStyle:{width:"100px"}},[e._v(e._s(t.department))])]),e._v(" "),s("td",{staticClass:"border-bottom"},[s("div",{staticClass:"truncate-text",staticStyle:{width:"100px"}},[e._v(e._s(t.position))])]),e._v(" "),s("td",{staticClass:"border-bottom"},[e._v("\n                                        -\n                                    ")])])}))],2)])])]),e._v(" "),s("a",{staticClass:"btn btn-outline-primary btn-sm w-100",attrs:{href:"#"},on:{click:function(t){e.add_user_form=1}}},[e._v("\n                    Создать нового пользователя\n                ")]),e._v(" "),s("span",{staticStyle:{"font-style":"italic","font-size":"10px"}},[e._v("* если пользователь не Kcell или Email учётная запись")]),e._v(" "),s("hr"),e._v(" "),s("a",{staticClass:"btn btn-outline-success btn-sm w-100",attrs:{href:"#"},on:{click:function(t){return e.saveUsersToNotification()}}},[e._v("\n                    Сохранить\n                ")])],1)]):e._e(),e._v(" "),0==e.add_user_form?s("div",{staticClass:"row no-space",staticStyle:{height:"95%"}},[s("div",{staticClass:"table-responsive"},[s("vue-bootstrap4-table",{attrs:{rows:e.notif_list,columns:e.columns,config:e.config,classes:e.classes}})],1)]):e._e()])])}),[],!1,null,null,null);t.default=v.exports},"KnK+":function(e,t,s){"use strict";var r=s("txcL"),a={name:"TheContentMixin",methods:{generateBreadcrumb:function(e){this.$store.dispatch(r.a,e)},getTitle:function(e){return e[e.length-1].text},setNotifications:function(e){this.$store.dispatch(r.b,e)},scrollToTop:function(){window.scroll({top:0,left:0,behavior:"smooth"})}}},i=s("KHd+"),o=Object(i.a)(a,void 0,void 0,!1,null,null,null);t.a=o.exports}}]);