(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{"8Ab/":function(t,e,i){"use strict";i.r(e);var r=i("ta7f"),o=i("kGIl"),s=i.n(o),a=i("Snq/"),n=i.n(a),c=(i("bfyA"),i("5A0h"),{name:"TicketCreate",mixins:[i("KnK+").a],data:function(){return{title:"Изменение тикета #"+this.$route.params.id,breadcrumbs:[{text:"Главная",to:{path:"/"}},{text:"TroubleTicket",to:{path:"/troubleticket"}},{text:"Изменение тикета #"+this.$route.params.id,active:!0}],test:null,priority_manual:0,form:{id_ticket:null,priority_name:"Emergency",priority:1,tt_type:null,service_type:[],network_type:null,network_list:null,region:null,source_name:null,interruption:null,affection:null,influence:null,prob_cause_list:null,root_cause_list:null,start_date:null,start_time:null,finish_date:null,finish_time:null,description:null,down_site_2g:null,down_site_3g:null,down_site_4g:null,old_service_type:[],old_region:null},serviceSearch:"",settlementSearch:"",formErrors:null,isLoading:!1,service_options:[],subnetwork_options:[],settlement_options:[],problem_causes_options:[],influence_options:[{value:1,text:"Нет"},{value:2,text:"Kcell"},{value:3,text:"Activ"},{value:4,text:"Kcell & Activ"}],affection_options:[{value:1,text:"Без влияния"},{value:2,text:"Полное"},{value:3,text:"Частичное"}],tt_type_options:[{value:1,text:"Событие"},{value:2,text:"Инцидент"}]}},components:{Loading:s.a,vSelect:n.a},watch:{settlementSearch:function(t){var e=this;t.length>2&&axios.get("/api/catalog/settlement/search?query=".concat(t)).then((function(t){e.settlement_options=t.data.list}))},serviceSearch:function(t){var e=this;t.length>2&&axios.get("/api/catalog/service_options?query=".concat(t)).then((function(t){e.service_options=t.data.list}))},"form.region":function(t,e){this.checkPriority()}},mounted:function(){this.generateBreadcrumb(this.breadcrumbs),this.getSubnetworks(),this.getServiceProblems(),this.getTicketUpdates()},methods:{checkPriority:function(){console.log("asd",this.form.region);var t,e,i=3;if(this.form.region)for(t=0;t<this.form.region.length;t++)this.form.region[t].city_type<i&&(i=this.form.region[t].city_type);if(this.form.service_type)for(e=0;e<this.form.service_type.length;e++)this.form.service_type[e].id_city_type=i,this.form.service_type[e].id_service&&this.form.service_type[e].id_influence&&this.form.service_type[e].id_city_type&&(console.log("service_type: id_service:",this.form.service_type[e].id_service),console.log("service_type: id_influence:",this.form.service_type[e].id_influence),console.log("service_type: city_type:",this.form.service_type[e].id_city_type),this.getServicePriority(this.form.service_type[e].id_service,this.form.service_type[e].id_influence,this.form.service_type[e].id_city_type))},updatePriority:function(){var t,e=6;for(t=0;t<this.form.service_type.length;t++)this.form.service_type[t].id_priority<e&&(e=this.form.service_type[t].id_priority);this.form.priority=e},dateChanged:function(){var t=(this.form.start_date+" "+this.form.start_time).replace(/(..)\.(..)\.(....) (..):(..)/,"$3-$2-$1 $4:$5"),e=new Date(t);console.log("date1: ",e.getTime());var i=new Date;console.log("date2: ",i.getTime());var r,o=new Date;if(o=i.getTime()-2592e6,(e>i||e<o)&&(alert("Дата указана некорректно, проверьте пожалуйста"),this.form.start_date="",this.form.start_time=""),this.form.service_type)for(r=0;r<this.form.service_type.length;r++)this.form.service_type[r].start_date=this.form.start_date,this.form.service_type[r].start_time=this.form.start_time},dateChanged2:function(){var t=(this.form.finish_date+" "+this.form.finish_time).replace(/(..)\.(..)\.(....) (..):(..)/,"$3-$2-$1 $4:$5"),e=new Date(t);console.log("date1: ",e.getTime());var i=new Date;console.log("date2: ",i.getTime());var r,o=(this.form.start_date+" "+this.form.start_time).replace(/(..)\.(..)\.(....) (..):(..)/,"$3-$2-$1 $4:$5"),s=new Date(o);if((e>i||e<s)&&(alert("Дата указана некорректно, проверьте пожалуйста"),this.form.finish_date="",this.form.finish_time=""),this.form.service_type)for(r=0;r<this.form.service_type.length;r++)this.form.service_type[r].finish_date=this.form.finish_date,this.form.service_type[r].finish_time=this.form.finish_time},getTicketUpdates:function(){var t=this;axios.get("/api/troubleticket/updateData/"+this.$route.params.id).then((function(e){t.form.id_ticket=e.data.ticket.id,t.form.priority=e.data.ticket.priority,t.form.tt_type=e.data.ticket.tt_type,t.form.network_list=e.data.ticket.network_list,t.form.source_name=e.data.ticket.source_name,t.form.interruption=e.data.ticket.interruption,t.form.affection=e.data.ticket.affection,t.form.influence=e.data.ticket.influence,t.form.prob_cause_list=e.data.ticket.prob_cause_list,t.form.root_cause_list=e.data.ticket.root_cause_list,t.form.description=e.data.ticket.description,t.form.start_date=e.data.ticket.start_date,t.form.start_time=e.data.ticket.start_time,t.form.down_site_2g=e.data.ticket.down_site_2g,t.form.down_site_3g=e.data.ticket.down_site_3g,t.form.down_site_4g=e.data.ticket.down_site_4g,t.form.finish_date=e.data.ticket.finish_date,t.form.finish_time=e.data.ticket.finish_time,t.form.service_type=e.data.ticket.service_list,t.form.region=e.data.ticket.city_list}))},getSubnetworks:function(){var t=this;axios.get("/api/catalog/subnetworks_list").then((function(e){t.subnetwork_options=e.data.list}))},getServiceProblems:function(){var t=this;axios.get("/api/catalog/problem_cause_list").then((function(e){t.problem_causes_options=e.data.list}))},getServicePriority:function(t,e,i){var r=this;axios.get("/api/catalog/service_priority/search?id_service=".concat(t,"&id_influence=").concat(e,"&id_city_type=").concat(i)).then((function(e){var i,o=6;for(e.data.priority&&(o=e.data.priority.id_priority),i=0;i<r.form.service_type.length;i++)r.form.service_type[i].id_service==t&&(r.form.service_type[i].id_priority=o);r.updatePriority()}))},update:function(){var t=this;this.form.root_cause_list?this.form.root_cause=this.form.root_cause_list.id:this.form.root_cause=null,axios.post("/api/troubleticket/update/"+this.$data.form.id_ticket,this.$data.form).then((function(e){console.log(e),1===e.data.success&&t.$router.push({path:"/troubleticket/"+e.data.ticket.id})})).catch((function(e){if(e.response.data)return t.formErrors=e.response.data.errors,void(t.isLoading=!1)}))}},validations:{form:{service_type:{required:r.required},network_type:{required:r.required},region:{required:r.required},source_name:{required:r.required},probable_cause:{required:r.required},description:{required:r.required,minLength:Object(r.minLength)(3),maxLength:Object(r.maxLength)(4e3)},tt_type:{required:r.required},affection:{required:r.required},influence:{required:r.required},start_date:{required:r.required},start_time:{required:r.required}}}}),l=i("KHd+"),m=Object(l.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"card"},[i("div",{staticClass:"card-body"},[i("form",{on:{submit:function(e){return e.preventDefault(),t.update()}}},[i("div",{staticClass:"row no-space"},[i("div",{staticClass:"col-md-5"},[i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"name"}},[t._v("Тип сервиса")]),t._v(" "),i("v-select",{attrs:{options:t.service_options,multiple:""},on:{search:function(e){return t.serviceSearch=e}},model:{value:t.form.service_type,callback:function(e){t.$set(t.form,"service_type",e)},expression:"form.service_type"}})],1),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"name"}},[t._v("Подсеть")]),t._v(" "),i("v-select",{attrs:{options:t.subnetwork_options},model:{value:t.form.network_list,callback:function(e){t.$set(t.form,"network_list",e)},expression:"form.network_list"}})],1),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"name"}},[t._v("Город")]),t._v(" "),i("v-select",{attrs:{options:t.settlement_options,multiple:""},on:{search:function(e){return t.settlementSearch=e}},model:{value:t.form.region,callback:function(e){t.$set(t.form,"region",e)},expression:"form.region"}})],1),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"name"}},[t._v("Возможная причина проблемы")]),t._v(" "),i("v-select",{attrs:{options:t.problem_causes_options},model:{value:t.form.prob_cause_list,callback:function(e){t.$set(t.form,"prob_cause_list",e)},expression:"form.prob_cause_list"}})],1),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"name"}},[t._v("Корневая причина проблемы")]),t._v(" "),i("v-select",{attrs:{options:t.problem_causes_options},model:{value:t.form.root_cause_list,callback:function(e){t.$set(t.form,"root_cause_list",e)},expression:"form.root_cause_list"}})],1),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"source_name"}},[t._v("Возможный источник проблемы")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.form.source_name,expression:"form.source_name"}],staticClass:"form-control",attrs:{type:"text",id:"source_name"},domProps:{value:t.form.source_name},on:{input:function(e){e.target.composing||t.$set(t.form,"source_name",e.target.value)}}})]),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"description"}},[t._v("Описание")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.description,expression:"form.description"}],staticClass:"form-control",class:{"is-invalid":t.$v.form.description.$error},staticStyle:{height:"auto"},attrs:{id:"description",rows:"4"},domProps:{value:t.form.description},on:{blur:function(e){return t.$v.form.description.$touch()},input:function(e){e.target.composing||t.$set(t.form,"description",e.target.value)}}}),t._v(" "),t.$v.form.description.required?t._e():i("div",{staticClass:"invalid-feedback"},[t._v("Обязательно для\n                                заполнения\n                            ")]),t._v(" "),t.$v.form.description.minLength?t._e():i("div",{staticClass:"invalid-feedback"},[t._v("\n                                Минимальная длина "+t._s(t.$v.form.description.$params.minLength.min)+" символов. Сейчас\n                                "+t._s(t.form.description.length)+".\n                            ")]),t._v(" "),t.$v.form.description.maxLength?t._e():i("div",{staticClass:"invalid-feedback"},[t._v("\n                                Максимальная длина "+t._s(t.$v.form.description.$params.maxLength.max)+" символов. Сейчас\n                                "+t._s(t.form.description.length)+".\n                            ")])])]),t._v(" "),i("div",{staticClass:"col-md-7"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-6"},[i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"tt_type"}},[t._v("Тип тикеты")]),t._v(" "),i("b-form-group",[i("b-form-radio-group",{attrs:{id:"radio-group-3",options:t.tt_type_options,name:"tt_type"},model:{value:t.form.tt_type,callback:function(e){t.$set(t.form,"tt_type",e)},expression:"form.tt_type"}})],1)],1),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"affection"}},[t._v("Влияние на сервис")]),t._v(" "),i("b-form-group",[i("b-form-radio-group",{attrs:{id:"radio-group-2",options:t.affection_options,name:"affection"},model:{value:t.form.affection,callback:function(e){t.$set(t.form,"affection",e)},expression:"form.affection"}})],1)],1),t._v(" "),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"influence"}},[t._v("Бренд")]),t._v(" "),i("b-form-group",[i("b-form-radio-group",{attrs:{id:"radio-group-1",options:t.influence_options,name:"influence"},model:{value:t.form.influence,callback:function(e){t.$set(t.form,"influence",e)},expression:"form.influence"}})],1)],1)]),t._v(" "),i("div",{staticClass:"col-md-6"},[i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"priority"}},[t._v("\n                                        Приоритет \n                                        "),i("button",{staticClass:"btn btn-sm float-right",attrs:{type:"button"},on:{click:function(e){t.priority_manual=1}}},[i("b-icon",{staticClass:"rounded",attrs:{icon:"pencil-square",scale:"1","font-scale":"1",variant:"primary"}})],1)]),t._v(" "),1==t.form.priority?i("input",{staticClass:"form-control",attrs:{type:"text",id:"priority",value:"Emergency",disabled:""}}):t._e(),t._v(" "),2==t.form.priority?i("input",{staticClass:"form-control",attrs:{type:"text",id:"priority",value:"Critical",disabled:""}}):t._e(),t._v(" "),3==t.form.priority?i("input",{staticClass:"form-control",attrs:{type:"text",id:"priority",value:"High",disabled:""}}):t._e(),t._v(" "),4==t.form.priority?i("input",{staticClass:"form-control",attrs:{type:"text",id:"priority",value:"Medium",disabled:""}}):t._e(),t._v(" "),5==t.form.priority?i("input",{staticClass:"form-control",attrs:{type:"text",id:"priority",value:"Low",disabled:""}}):t._e(),t._v(" "),6==t.form.priority?i("input",{staticClass:"form-control",attrs:{type:"text",id:"priority",value:"Неопределен",disabled:""}}):t._e(),t._v(" "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.form.priority,expression:"form.priority"},{name:"show",rawName:"v-show",value:1==t.priority_manual,expression:"priority_manual == 1"}],staticClass:"form-control",staticStyle:{"margin-top":"3px"},attrs:{id:"priority2"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"priority",e.target.multiple?i:i[0])}}},[i("option",{attrs:{value:"1"}},[t._v("Emergency")]),t._v(" "),i("option",{attrs:{value:"2"}},[t._v("Critical")]),t._v(" "),i("option",{attrs:{value:"3"}},[t._v("High")]),t._v(" "),i("option",{attrs:{value:"4"}},[t._v("Medium")]),t._v(" "),i("option",{attrs:{value:"5"}},[t._v("Low")])])]),t._v(" "),i("div",{staticClass:"form-row"},[i("div",{staticClass:"form-group col-md-6"},[i("label",{attrs:{for:"start_date"}},[t._v("Дата начала")]),t._v(" "),i("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:"##.##.####",expression:"'##.##.####'"}],class:{"is-invalid":t.$v.form.start_date.$error},attrs:{type:"text",id:"start_date",placeholder:"dd.mm.yyyy"},on:{blur:function(e){return t.$v.form.start_date.$touch()}},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}}),t._v(" "),t.$v.form.start_date.required?t._e():i("div",{staticClass:"invalid-feedback"},[t._v("\n                                            Обязательно для заполнения\n                                        ")])],1),t._v(" "),i("div",{staticClass:"form-group col-md-6"},[i("label",{attrs:{for:"start_time"}},[t._v("Время начала")]),t._v(" "),i("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:"##:##",expression:"'##:##'"}],class:{"is-invalid":t.$v.form.start_time.$error},attrs:{type:"text",id:"start_time",placeholder:"HH:mm"},on:{blur:function(e){return t.$v.form.start_time.$touch()},change:function(e){return t.dateChanged()}},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}}),t._v(" "),t.$v.form.start_time.required?t._e():i("div",{staticClass:"invalid-feedback"},[t._v("\n                                            Обязательно для заполнения\n                                        ")])],1)]),t._v(" "),i("div",{staticClass:"form-row"},[i("div",{staticClass:"form-group col-md-6"},[i("label",{attrs:{for:"finish_date"}},[t._v("Дата закрытия")]),t._v(" "),i("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:"##.##.####",expression:"'##.##.####'"}],attrs:{type:"text",id:"finish_date",placeholder:"dd.mm.yyyy"},model:{value:t.form.finish_date,callback:function(e){t.$set(t.form,"finish_date",e)},expression:"form.finish_date"}})],1),t._v(" "),i("div",{staticClass:"form-group col-md-6"},[i("label",{attrs:{for:"finish_time"}},[t._v("Время закрытия")]),t._v(" "),i("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:"##:##",expression:"'##:##'"}],attrs:{type:"text",id:"finish_time",placeholder:"HH:mm"},on:{change:function(e){return t.dateChanged2()}},model:{value:t.form.finish_time,callback:function(e){t.$set(t.form,"finish_time",e)},expression:"form.finish_time"}})],1)])])]),t._v(" "),i("div",{staticClass:"border",staticStyle:{"min-height":"200px"}},[i("table",{staticClass:"table table-sm table-light"},t._l(t.form.service_type,(function(e,r){return i("tr",{key:r},[i("td",{staticClass:"border-bottom"},[i("div",{staticClass:"form-row"},[i("div",{staticClass:"form-group col-md-7"},[i("div",[t._v("\n                                                    -> "+t._s(e.group_name)+"\n                                                ")]),t._v(" "),i("div",[t._v("\n                                                    ---\x3e "+t._s(e.service_name)+"\n                                                ")]),t._v(" "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.form.service_type[r].id_influence,expression:"form.service_type[index].id_influence"}],staticClass:"form-control",attrs:{id:"query_type"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form.service_type[r],"id_influence",e.target.multiple?i:i[0])},function(e){return t.checkPriority()}]}},[i("option",{attrs:{disabled:"",value:""}},[t._v("Выберите")]),t._v(" "),t._l(e.influence_options,(function(e){return i("option",{domProps:{value:e.id_influence}},[t._v("\n                                                        "+t._s(e.label)+"\n                                                    ")])}))],2)]),t._v(" "),i("div",{staticClass:"col-md-5"},[i("div",{staticClass:"row",staticStyle:{margin:"0px"}},[i("div",{staticClass:"form-group col-md-2 text-right",staticStyle:{padding:"0px 5px"}},[t._v("\n                                                        НЧ:\n                                                    ")]),t._v(" "),i("div",{staticClass:"form-group col-md-5",staticStyle:{padding:"0px"}},[i("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:"##.##.####",expression:"'##.##.####'"}],attrs:{type:"text",id:"start_date",placeholder:"dd.mm.yyyy"},model:{value:t.form.service_type[r].start_date,callback:function(e){t.$set(t.form.service_type[r],"start_date",e)},expression:"form.service_type[index].start_date"}})],1),t._v(" "),i("div",{staticClass:"form-group col-md-5",staticStyle:{padding:"0px"}},[i("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:"##:##",expression:"'##:##'"}],attrs:{type:"text",id:"start_time",placeholder:"HH:mm"},model:{value:t.form.service_type[r].start_time,callback:function(e){t.$set(t.form.service_type[r],"start_time",e)},expression:"form.service_type[index].start_time"}})],1)]),t._v(" "),i("div",{staticClass:"row",staticStyle:{margin:"0px"}},[i("div",{staticClass:"form-group col-md-2 text-right",staticStyle:{padding:"0px 5px"}},[t._v("\n                                                        КН:\n                                                    ")]),t._v(" "),i("div",{staticClass:"form-group col-md-5",staticStyle:{padding:"0px"}},[i("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:"##.##.####",expression:"'##.##.####'"}],attrs:{type:"text",id:"finish_date",placeholder:"dd.mm.yyyy"},model:{value:t.form.service_type[r].finish_date,callback:function(e){t.$set(t.form.service_type[r],"finish_date",e)},expression:"form.service_type[index].finish_date"}})],1),t._v(" "),i("div",{staticClass:"form-group col-md-5",staticStyle:{padding:"0px"}},[i("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:"##:##",expression:"'##:##'"}],attrs:{type:"text",id:"finish_time",placeholder:"HH:mm"},model:{value:t.form.service_type[r].finish_time,callback:function(e){t.$set(t.form.service_type[r],"finish_time",e)},expression:"form.service_type[index].finish_time"}})],1)])])])])])})),0)]),t._v(" "),t.formErrors?i("div",{staticClass:"alert alert-danger"},t._l(t.formErrors,(function(e,r){return i("div",{key:r},[t._v("\n                                "+t._s(e.join("\n"))+"\n                            ")])})),0):t._e()])]),t._v(" "),i("div",{staticClass:"float-right"},[i("button",{staticClass:"btn btn-sm btn-outline-primary",attrs:{type:"submit"}},[t._v("Изменить")]),t._v(" "),i("button",{staticClass:"btn btn-sm btn-outline-dark",on:{click:function(e){t.modalVisibility=!1}}},[t._v("Отмена")])])])]),t._v(" "),i("div",{staticClass:"card-footer"},[t._v("   \n            "+t._s(t.test)+"\n        ")])])])}),[],!1,null,null,null);e.default=m.exports},"KnK+":function(t,e,i){"use strict";var r=i("txcL"),o={name:"TheContentMixin",methods:{generateBreadcrumb:function(t){this.$store.dispatch(r.a,t)},getTitle:function(t){return t[t.length-1].text},setNotifications:function(t){this.$store.dispatch(r.b,t)},scrollToTop:function(){window.scroll({top:0,left:0,behavior:"smooth"})}}},s=i("KHd+"),a=Object(s.a)(o,void 0,void 0,!1,null,null,null);e.a=a.exports}}]);